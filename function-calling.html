<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Robota API 문서</title>
  <meta name="description" content="Robota API 문서">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify@4/themes/vue.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🤖</text></svg>">
  <style>
    :root {
      --theme-color: #42b983;
    }
    .markdown-section {
      max-width: 900px;
      padding: 30px;
    }
    .markdown-section code {
      background-color: #f8f8f8;
    }
  </style>
</head>
<body>
  <div class="markdown-section">
    <h1>함수 호출 (Function Calling)</h1>
<p>함수 호출은 AI 모델이 사전 정의된 함수를 호출할 수 있게 하는 기능입니다. 이를 통해 AI는 외부 시스템과 상호작용하고, 데이터를 검색하거나 계산을 수행할 수 있습니다.</p>
<h2>기본적인 함수 호출</h2>
<p>Robota에서 함수를 정의하고 등록하는 방법은 다음과 같습니다:</p>
<pre><code class="language-typescript">import { Robota, OpenAIProvider } from &#39;robota&#39;;
import OpenAI from &#39;openai&#39;;

// OpenAI 클라이언트 생성
const openaiClient = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

// Robota 인스턴스 생성
const robota = new Robota({
  provider: new OpenAIProvider({
    model: &#39;gpt-4&#39;,
    client: openaiClient
  })
});

// 함수 정의
const functions = {
  // 날씨 검색 함수
  getWeather: async (location: string, unit: &#39;celsius&#39; | &#39;fahrenheit&#39; = &#39;celsius&#39;) =&gt; {
    console.log(`${location}의 날씨를 ${unit} 단위로 검색 중...`);
    // 실제 구현에서는 날씨 API 호출
    return { 
      temperature: 25, 
      condition: &#39;맑음&#39;, 
      humidity: 60,
      unit
    };
  },
  
  // 수학 계산 함수
  calculate: async (expression: string) =&gt; {
    console.log(`계산 중: ${expression}`);
    // 주의: eval은 보안상 위험할 수 있습니다. 실제 사용시 안전한 대안을 고려하세요.
    return { result: eval(expression) };
  }
};

// 함수 등록
robota.registerFunctions(functions);

// 실행
const result = await robota.run(&#39;서울의 날씨가 어떤지 알려주고, 25 + 15의 계산 결과도 보여줘.&#39;);
console.log(result);
</code></pre>
<h2>함수 스키마 자동 추출</h2>
<p>Robota는 타입스크립트의 타입 정보를 사용하여 함수의 매개변수와 반환 타입에 대한 스키마를 자동으로 생성합니다. 이렇게 생성된 스키마는 AI 모델에게 함수의 사용법을 알려주는 데 사용됩니다.</p>
<h2>복잡한 매개변수를 가진 함수</h2>
<p>객체나 배열과 같은 복잡한 매개변수를 가진 함수도 정의할 수 있습니다:</p>
<pre><code class="language-typescript">// 복잡한 매개변수를 가진 함수
const functions = {
  createUser: async (userData: {
    name: string;
    email: string;
    age: number;
    preferences?: {
      theme: &#39;light&#39; | &#39;dark&#39;;
      notifications: boolean;
    }
  }) =&gt; {
    console.log(`사용자 생성 중: ${userData.name}`);
    return { 
      id: &#39;user-123&#39;,
      createdAt: new Date().toISOString(),
      ...userData
    };
  }
};

robota.registerFunctions(functions);
</code></pre>
<h2>zod를 사용한 스키마 검증</h2>
<p>보다 강력한 매개변수 검증을 위해 <code>zod</code> 라이브러리를 사용할 수 있습니다:</p>
<pre><code class="language-typescript">import { z } from &#39;zod&#39;;
import { Robota, OpenAIProvider, createFunction } from &#39;robota&#39;;

// zod 스키마를 사용한 함수 생성
const sendEmail = createFunction({
  name: &#39;sendEmail&#39;,
  description: &#39;지정된 수신자에게 이메일을 보냅니다&#39;,
  parameters: z.object({
    to: z.string().email(&#39;유효한 이메일 주소가 필요합니다&#39;),
    subject: z.string().min(1, &#39;제목은 비어있을 수 없습니다&#39;),
    body: z.string(),
    cc: z.array(z.string().email()).optional(),
    bcc: z.array(z.string().email()).optional(),
    attachments: z.array(z.string().url()).optional()
  }),
  execute: async (params) =&gt; {
    console.log(`이메일 전송 중: ${params.subject}`);
    // 실제 이메일 전송 로직
    return { 
      status: &#39;sent&#39;,
      messageId: &#39;msg-&#39; + Math.random().toString(36).substring(2, 9)
    };
  }
});

const robota = new Robota({
  provider: new OpenAIProvider({
    apiKey: process.env.OPENAI_API_KEY,
    model: &#39;gpt-4&#39;
  })
});

// 함수 등록
robota.registerFunctions({ sendEmail });
</code></pre>
<h2>함수 호출 모드</h2>
<p>Robota는 다양한 함수 호출 모드를 지원합니다:</p>
<h3>자동 모드 (기본값)</h3>
<p>AI가 필요에 따라 함수를 자동으로 호출합니다:</p>
<pre><code class="language-typescript">// 개별 호출에서 설정
const result = await robota.run(&#39;내일 서울의 날씨가 어떤지 알려줘&#39;, {
  functionCallMode: &#39;auto&#39; // 기본값이므로 생략 가능
});

// 전역 설정
robota.setFunctionCallMode(&#39;auto&#39;);
</code></pre>
<h3>강제 모드</h3>
<p>특정 함수를 강제로 호출하도록 지시합니다:</p>
<pre><code class="language-typescript">// 개별 호출에서 설정
const result = await robota.run(&#39;내일 서울의 날씨가 어떤지 알려줘&#39;, {
  functionCallMode: &#39;force&#39;,
  forcedFunction: &#39;getWeather&#39;,
  forcedArguments: { location: &#39;서울&#39;, unit: &#39;celsius&#39; }
});

// 전역 설정 + 개별 호출에서 함수 지정
robota.setFunctionCallMode(&#39;force&#39;);
const result = await robota.run(&#39;아무 내용&#39;, {
  forcedFunction: &#39;getWeather&#39;,
  forcedArguments: { location: &#39;서울&#39; }
});
</code></pre>
<h3>비활성화 모드</h3>
<p>함수 호출을 완전히 비활성화합니다:</p>
<pre><code class="language-typescript">// 개별 호출에서 설정
const result = await robota.run(&#39;안녕하세요!&#39;, {
  functionCallMode: &#39;disabled&#39;
});

// 전역 설정
robota.setFunctionCallMode(&#39;disabled&#39;);
</code></pre>
<h2>함수 호출 추적 및 로깅</h2>
<p>함수 호출을 추적하고 로깅할 수 있습니다:</p>
<pre><code class="language-typescript">const robota = new Robota({
  provider: new OpenAIProvider({
    model: &#39;gpt-4&#39;,
    client: openaiClient
  }),
  onFunctionCall: (functionName, args, result) =&gt; {
    console.log(`함수 호출: ${functionName}`);
    console.log(&#39;인자:&#39;, args);
    console.log(&#39;결과:&#39;, result);
  }
});
</code></pre>
<h2>함수 호출 설정 관리</h2>
<p>보안과 안전성을 위해 함수 호출에 전역 설정을 적용할 수 있습니다:</p>
<pre><code class="language-typescript">// 초기화 시 설정
const robota = new Robota({
  provider: new OpenAIProvider({
    model: &#39;gpt-4&#39;,
    client: openaiClient
  }),
  functionCallConfig: {
    maxCalls: 5, // 최대 함수 호출 횟수
    timeout: 10000, // 함수 호출 타임아웃 (ms)
    allowedFunctions: [&#39;getWeather&#39;, &#39;calculate&#39;], // 허용된 함수 목록
    defaultMode: &#39;auto&#39; // 기본 함수 호출 모드
  }
});

// 나중에 설정 변경
robota.configureFunctionCall({
  mode: &#39;auto&#39;,
  maxCalls: 10,
  timeout: 15000,
  allowedFunctions: [&#39;getWeather&#39;, &#39;calculate&#39;, &#39;searchDatabase&#39;]
});
</code></pre>
<p>함수 호출 모드만 변경할 수도 있습니다:</p>
<pre><code class="language-typescript">robota.setFunctionCallMode(&#39;auto&#39;); // &#39;auto&#39;, &#39;disabled&#39;, &#39;force&#39; 중 하나 선택
</code></pre>

  </div>
</body>
</html>